<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>馬達負載計算工具 | Industrial Motor Load Calculator</title>
    <meta name="description" content="專業垂直捲線機構馬達負載計算工具，支援功率與荷重推算。Professional Vertical Winch Motor Load Calculator.">
    <meta property="og:title" content="馬達負載計算工具 Pro">
    <meta property="og:description" content="快速計算馬達功率、轉速與容許荷重，工業設計師必備工具。">
    <meta property="og:image" content="https://placehold.co/600x400/0f172a/f59e0b?text=Motor+Calc+Pro">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        ind: { deep: '#020617', panel: '#111827', accent: '#f59e0b', border: '#334155', danger: '#ef4444' }
                    }
                }
            }
        }
    </script>
    
    <style>
        /* Custom Base Styles */
        body { 
            background-color: #020617; 
            background-image: radial-gradient(#1e293b 0.5px, transparent 0.5px); 
            background-size: 20px 20px; 
            font-family: 'Inter', system-ui, -apple-system, sans-serif; 
            color: #94a3b8; 
            -webkit-font-smoothing: antialiased;
        }
        
        /* Layout Utilities */
        .report-grid { display: grid; grid-template-columns: 1fr 1fr; background: #0f172a; border: 1px solid #334155; position: relative; }
        .report-grid::before { content: ''; position: absolute; top: -2px; left: -2px; width: 12px; height: 12px; border-top: 3px solid #f59e0b; border-left: 3px solid #f59e0b; z-index: 10; }
        .report-grid::after { content: ''; position: absolute; bottom: -2px; right: -2px; width: 12px; height: 12px; border-bottom: 3px solid #f59e0b; border-right: 3px solid #f59e0b; z-index: 10; }
        
        .report-cell { 
            padding: 22px 10px; 
            border: 0.5px solid #1e293b; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            min-height: 110px; 
            background-color: #0f172a; /* Solid background for stable screenshots */
        }
        
        /* Input & Interactive Elements */
        input:focus { box-shadow: 0 0 15px rgba(245, 158, 11, 0.2); border-color: #f59e0b !important; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        
        .btn-shadow { box-shadow: 0 4px 0px 0px rgba(0,0,0,0.5); transition: all 0.1s; }
        .btn-shadow:active { transform: translateY(2px); box-shadow: 0 1px 0px 0px rgba(0,0,0,0.5); }
        
        /* Animations */
        .fade-show { display: block !important; animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .error-shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }
    </style>
</head>
<body class="min-h-screen flex justify-center selection:bg-ind-accent selection:text-ind-deep">

<div id="capture-area" class="w-full max-w-md bg-ind-deep min-h-screen flex flex-col p-6 border-x border-slate-800 shadow-2xl relative">
    
    <header class="flex justify-between items-start mb-8">
        <div class="flex gap-3">
            <div class="w-1.5 bg-ind-accent"></div>
            <div>
                <h1 id="main-title" class="text-3xl font-black text-white leading-tight tracking-tighter uppercase italic"></h1>
                <div class="flex items-center gap-2 mt-2">
                    <span class="text-[10px] bg-slate-800 text-slate-400 px-2 py-0.5 rounded font-bold tracking-widest uppercase">Industrial System V3.0</span>
                    <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                </div>
            </div>
        </div>
        <button id="lang-btn" onclick="app.toggleLanguage()" class="text-[11px] border border-slate-700 text-slate-400 px-3 py-1 hover:bg-slate-800 transition uppercase font-black rounded-sm">EN/中</button>
    </header>

    <main class="flex-grow space-y-5">
        <div class="grid grid-cols-2 gap-x-4 gap-y-4">
            <div>
                <label id="lbl-radius" class="text-[11px] font-bold text-slate-500 uppercase tracking-widest mb-1 block"></label>
                <input type="number" inputmode="decimal" id="radius" class="w-full bg-ind-panel border border-slate-800 rounded-sm p-3 text-xl text-white outline-none font-mono font-bold border-b-2 border-b-slate-700 transition-colors placeholder-slate-700" placeholder="0">
            </div>
            <div>
                <label id="lbl-speed" class="text-[11px] font-bold text-slate-500 uppercase tracking-widest mb-1 block"></label>
                <input type="number" inputmode="decimal" id="speed" class="w-full bg-ind-panel border border-slate-800 rounded-sm p-3 text-xl text-white outline-none font-mono font-bold border-b-2 border-b-slate-700 transition-colors placeholder-slate-700" placeholder="0">
            </div>
            <div>
                <label id="lbl-ratio" class="text-[11px] font-bold text-slate-500 uppercase tracking-widest mb-1 block"></label>
                <input type="number" inputmode="decimal" id="ratio" class="w-full bg-ind-panel border border-slate-800 rounded-sm p-3 text-xl text-white outline-none font-mono font-bold border-b-2 border-b-slate-700 transition-colors placeholder-slate-700" placeholder="0">
            </div>
            <div>
                <label id="lbl-gear" class="text-[11px] font-bold text-slate-500 uppercase tracking-widest mb-1 block"></label>
                <select id="gearType" class="w-full bg-ind-panel border border-slate-800 rounded-sm p-3 text-lg text-white outline-none appearance-none font-bold border-b-2 border-b-slate-700 cursor-pointer"></select>
            </div>
        </div>
        
        <div>
            <label id="lbl-safety" class="text-[11px] font-bold text-slate-500 uppercase tracking-widest mb-1 block"></label>
            <select id="safety" class="w-full bg-ind-panel border border-slate-800 rounded-sm p-3 text-lg text-white outline-none font-bold border-b-2 border-b-slate-700 cursor-pointer"></select>
        </div>

        <div class="flex bg-ind-panel border border-slate-800 p-1 rounded select-none">
            <button onclick="app.setMode('power')" id="btn-mode-p" class="flex-1 py-3 text-sm font-black uppercase tracking-widest rounded transition-all">推算馬達功率</button>
            <button onclick="app.setMode('load')" id="btn-mode-l" class="flex-1 py-3 text-sm font-black uppercase tracking-widest text-slate-600 rounded transition-all">推算容許荷重</button>
        </div>

        <div class="bg-slate-900 p-5 border border-slate-800 transition-colors hover:border-slate-700">
            <div class="flex justify-between items-center mb-3">
                <label id="lbl-dynamic-input" class="text-xs font-black text-ind-accent uppercase tracking-[0.2em]"></label>
                <div id="unit-toggle" class="hidden flex text-[10px] font-bold border border-slate-700 rounded overflow-hidden">
                    <button id="btn-kw" onclick="app.setPowerUnit('kW')" class="px-3 py-1 transition-colors">kW</button>
                    <button id="btn-hp" onclick="app.setPowerUnit('HP')" class="px-3 py-1 transition-colors">HP</button>
                </div>
            </div>
            <input type="number" inputmode="decimal" id="mainInput" class="w-full bg-transparent text-6xl font-mono text-white outline-none font-black text-center tracking-tighter placeholder-slate-800" placeholder="0">
        </div>

        <div id="error-msg" class="hidden text-center text-red-500 text-xs font-bold bg-red-500/10 py-2 rounded border border-red-500/20"></div>

        <div id="report-container" class="hidden">
            <div class="flex items-center gap-3 mb-5 mt-4">
                <div class="w-2.5 h-8 bg-ind-accent"></div>
                <span id="lbl-report" class="text-2xl font-black text-white tracking-[0.1em] uppercase"></span>
            </div>
            
            <div id="report-grid" class="report-grid shadow-2xl">
                <div class="report-cell">
                    <span id="lbl-res-rpm" class="text-sm text-slate-300 font-bold uppercase mb-3"></span>
                    <span id="res-rpm" class="text-3xl font-mono font-bold text-white">---</span>
                    <span id="rpm-warning" class="hidden mt-1"></span>
                </div>
                <div class="report-cell">
                    <span id="lbl-res-load" class="text-sm text-slate-300 font-bold uppercase mb-3"></span>
                    <span id="res-load" class="text-3xl font-mono font-bold text-white">---</span>
                </div>
                
                <div class="report-cell">
                    <span id="lbl-res-torque" class="text-sm text-slate-300 font-bold uppercase mb-3"></span>
                    <span id="res-torque" class="text-3xl font-mono font-bold text-white">---</span>
                </div>
                <div class="report-cell">
                    <span id="lbl-res-sf" class="text-sm text-slate-300 font-bold uppercase mb-3"></span>
                    <span id="res-sf" class="text-3xl font-mono font-bold text-ind-accent">---</span>
                </div>
                
                <div class="report-cell col-span-2 py-12 border-t border-slate-800">
                    <span id="lbl-res-power" class="text-sm text-slate-300 font-bold uppercase mb-4"></span>
                    <span id="res-power" class="text-4xl font-mono font-bold leading-none flex items-baseline justify-center gap-1">---</span>
                </div>
            </div>
        </div>
    </main>

    <div class="grid grid-cols-3 gap-4 mt-8 pt-6 border-t border-slate-900">
        <button onclick="app.calculate()" class="bg-green-600 hover:bg-green-500 text-white py-4 rounded font-black text-sm btn-shadow uppercase tracking-widest flex justify-center items-center">
            <span id="btn-text-calc"></span>
        </button>
        <button onclick="app.resetTool()" class="bg-slate-800 hover:bg-slate-700 text-slate-300 py-4 rounded font-black text-sm btn-shadow uppercase tracking-widest flex justify-center items-center">
            <span id="btn-text-reset"></span>
        </button>
        <button onclick="app.generateReport()" class="bg-blue-600 hover:bg-blue-500 text-white py-4 rounded font-black text-sm btn-shadow uppercase tracking-widest flex justify-center items-center">
            <span id="btn-text-report"></span>
        </button>
    </div>
    
    <footer class="mt-10 text-center pb-8">
        <p class="text-xs text-slate-500 font-bold tracking-tight opacity-70">
            Copyright © 2025 ChangYi,Wu. All rights reserved.
        </p>
    </footer>
</div>

<script>
/**
 * Industrial Motor Load Calculator V3.0
 * Structured for maintainability and readability.
 */
const app = {
    // Constants
    G: 9.80665,
    HP_TO_KW: 0.7457,
    
    // State
    state: {
        mode: 'power', // 'power' or 'load'
        powerUnit: 'kW', // 'kW' or 'HP'
        lang: 'zh'
    },

    // UI Elements Cache
    el: {},

    // Translations Dictionary
    translations: {
        zh: {
            title: "垂直捲線機構<br><span class='text-ind-accent not-italic'>馬達負載計算</span>",
            radius: "捲輪半徑 (mm)", speed: "提升速度 (mm/min)", ratio: "減速比 (i)",
            gear: "減速機效率 (η)", safety: "安全係數 (S.F.)", modeP: "推算馬達功率",
            modeL: "推算容許荷重", inputLoad: "目標荷重 (kg)", inputPower: "馬達功率",
            report: "計算報告", resRPM: "馬達轉速 (RPM)", resSF: "安全係數 (S.F.)",
            resLoad: "容許荷重 (kg)", resPower: "馬達功率", resTorque: "輸出扭矩 (N-m)",
            btnCalc: "開始計算", btnReset: "重新計算", btnReport: "畫面截圖",
            rpmHigh: "⚠️ 轉速過高", rpmLow: "⚠️ 轉速偏低", rpmCrit: "⚠️ 危險轉速",
            errorEmpty: "請填寫所有欄位並確保數值大於 0",
            gearOptions: [{ val: "0.95", text: "齒輪 (95%)" }, { val: "0.90", text: "擺線 (90%)" }, { val: "0.70", text: "渦輪 (70%)" }],
            sfOptions: [{ val: "1.5", text: "1.5 (標準)" }, { val: "2.0", text: "2.0 (重負載)" }]
        },
        en: {
            title: "Vertical Winch<br><span class='text-ind-accent not-italic'>Motor Load Calc</span>",
            radius: "Drum Radius (mm)", speed: "Speed (mm/min)", ratio: "Ratio (i)",
            gear: "Efficiency (η)", safety: "S.F.", modeP: "Power Calc",
            modeL: "Load Calc", inputLoad: "Target Load (kg)", inputPower: "Motor Power",
            report: "CALC REPORT", resRPM: "Motor RPM", resSF: "Factor (S.F.)",
            resLoad: "Allow. Load (kg)", resPower: "Required Power", resTorque: "Torque (N-m)",
            btnCalc: "CALCULATE", btnReset: "RESET", btnReport: "OUTPUT",
            rpmHigh: "⚠️ HI-RPM", rpmLow: "⚠️ LO-RPM", rpmCrit: "⚠️ DANGER",
            errorEmpty: "Please fill in all fields with valid numbers",
            gearOptions: [{ val: "0.95", text: "Gear (95%)" }, { val: "0.90", text: "Cycloid (90%)" }, { val: "0.70", text: "Worm (70%)" }],
            sfOptions: [{ val: "1.5", text: "1.5 (Std)" }, { val: "2.0", text: "2.0 (Heavy)" }]
        }
    },

    // Initialization
    init() {
        // Cache elements for performance
        const ids = ['radius', 'speed', 'ratio', 'gearType', 'safety', 'mainInput', 'report-container', 'error-msg', 'btn-kw', 'btn-hp', 'lang-btn'];
        ids.forEach(id => this.el[id] = document.getElementById(id));
        
        this.populateDropdowns();
        this.updateUI();
    },

    populateDropdowns() {
        const t = this.translations[this.state.lang];
        const { gearType, safety } = this.el;
        const currentGear = gearType.value;
        const currentSafety = safety.value;

        gearType.innerHTML = "";
        t.gearOptions.forEach(o => gearType.add(new Option(o.text, o.val)));
        if (currentGear) gearType.value = currentGear;

        safety.innerHTML = "";
        t.sfOptions.forEach(o => safety.add(new Option(o.text, o.val)));
        safety.value = currentSafety || "1.5";
    },

    // Logic Actions
    toggleLanguage() {
        this.state.lang = (this.state.lang === 'zh') ? 'en' : 'zh';
        this.populateDropdowns();
        this.updateUI();
        if (this.el['report-container'].classList.contains('fade-show')) this.calculate();
    },

    setMode(mode) {
        this.state.mode = mode;
        const isPower = mode === 'power';
        
        // Update Button Styles
        document.getElementById('btn-mode-p').className = isPower 
            ? "flex-1 py-3 text-sm font-black uppercase tracking-widest rounded bg-ind-accent text-ind-deep" 
            : "flex-1 py-3 text-sm font-black uppercase tracking-widest text-slate-600 rounded hover:text-slate-400";
            
        document.getElementById('btn-mode-l').className = !isPower 
            ? "flex-1 py-3 text-sm font-black uppercase tracking-widest rounded bg-ind-accent text-ind-deep" 
            : "flex-1 py-3 text-sm font-black uppercase tracking-widest text-slate-600 rounded hover:text-slate-400";
            
        document.getElementById('unit-toggle').classList.toggle('hidden', isPower);
        this.updateUI();
        this.el['report-container'].classList.remove('fade-show');
        this.hideError();
    },

    setPowerUnit(unit) {
        this.state.powerUnit = unit;
        const isKW = unit === 'kW';
        this.el['btn-kw'].className = isKW ? "px-3 py-1 bg-slate-500 text-white uppercase" : "px-3 py-1 text-slate-400 uppercase hover:text-white";
        this.el['btn-hp'].className = !isKW ? "px-3 py-1 bg-slate-500 text-white uppercase" : "px-3 py-1 text-slate-400 uppercase hover:text-white";
        this.updateUI();
        if (this.el['report-container'].classList.contains('fade-show')) this.calculate();
    },

    updateUI() {
        const t = this.translations[this.state.lang];
        const ids = {
            'main-title': t.title, 'lbl-radius': t.radius, 'lbl-speed': t.speed,
            'lbl-ratio': t.ratio, 'lbl-gear': t.gear, 'lbl-safety': t.safety,
            'btn-mode-p': t.modeP, 'btn-mode-l': t.modeL, 'lbl-report': t.report,
            'lbl-res-rpm': t.resRPM, 'lbl-res-sf': t.resSF, 'lbl-res-load': t.resLoad,
            'lbl-res-power': t.resPower, 'lbl-res-torque': t.resTorque,
            'btn-text-calc': t.btnCalc, 'btn-text-reset': t.btnReset, 'btn-text-report': t.btnReport
        };

        for (const [id, text] of Object.entries(ids)) {
            const el = document.getElementById(id);
            if(el) el.innerHTML = text;
        }

        const dynamicLabel = (this.state.mode === 'power') ? t.inputLoad : `${t.inputPower} (${this.state.powerUnit})`;
        document.getElementById('lbl-dynamic-input').innerText = dynamicLabel;
    },

    showError(msg) {
        const errEl = this.el['error-msg'];
        errEl.innerText = msg;
        errEl.classList.remove('hidden');
        errEl.classList.add('error-shake');
        setTimeout(() => errEl.classList.remove('error-shake'), 500);
    },

    hideError() {
        this.el['error-msg'].classList.add('hidden');
    },

    formatNum(num, dec = 2) {
        return parseFloat(num.toFixed(dec)).toString();
    },

    calculate() {
        const { radius, speed, ratio, gearType, safety, mainInput } = this.el;
        const r = parseFloat(radius.value);
        const s = parseFloat(speed.value);
        const i = parseFloat(ratio.value);
        const eff = parseFloat(gearType.value);
        const sf = parseFloat(safety.value);
        const mainVal = parseFloat(mainInput.value);

        // Validation
        if (!r || !s || !i || !mainVal || r <= 0 || s <= 0 || i <= 0 || mainVal <= 0) {
            this.showError(this.translations[this.state.lang].errorEmpty);
            return;
        }
        this.hideError();

        // 1. RPM Calculation
        const motorRPM = (s / (2 * Math.PI * r)) * i;
        this.renderRPM(motorRPM);

        // 2. Power & Load Calculation
        const velocityMS = s / 1000 / 60; // m/s
        let loadKg = 0, powerKW = 0;

        const resLoadEl = document.getElementById('res-load');
        const resPowerEl = document.getElementById('res-power');

        if (this.state.mode === 'power') {
            loadKg = mainVal;
            powerKW = (loadKg * this.G * velocityMS / (1000 * eff)) * sf;
            
            // Styling for Power Mode
            resLoadEl.className = "text-3xl font-mono font-bold text-white";
            // Power is Red
            this.renderPowerText(powerKW, 'red');
        } else {
            powerKW = (this.state.powerUnit === 'HP') ? mainVal * this.HP_TO_KW : mainVal;
            loadKg = (powerKW * 1000 * eff) / (velocityMS * sf * this.G);
            
            // Styling for Load Mode
            resLoadEl.className = "text-3xl font-mono font-bold text-red-500";
            // Power is White
            this.renderPowerText(powerKW, 'white');
        }

        // 3. Render Results
        document.getElementById('res-sf').innerText = this.formatNum(sf, 1);
        resLoadEl.innerText = this.formatNum(loadKg, 1);
        document.getElementById('res-torque').innerText = this.formatNum(loadKg * this.G * (r / 1000), 1);
        
        this.el['report-container'].classList.add('fade-show');
    },

    renderRPM(rpm) {
        const t = this.translations[this.state.lang];
        const el = document.getElementById('res-rpm');
        const warn = document.getElementById('rpm-warning');
        
        el.innerText = this.formatNum(rpm, 1);
        warn.className = "hidden mt-1";
        
        if (rpm > 1800) {
            warn.innerText = t.rpmHigh;
            warn.className = "text-[10px] font-bold text-ind-accent block mt-1";
        }
        if (rpm > 3600) {
            warn.innerText = t.rpmCrit;
            warn.className = "text-[10px] font-bold text-red-500 animate-pulse block mt-1";
        }
        warn.classList.toggle('hidden', rpm <= 1800);
    },

    renderPowerText(kw, colorTheme) {
        const hp = kw / this.HP_TO_KW;
        const resPowerEl = document.getElementById('res-power');
        
        const valClass = colorTheme === 'red' ? "text-red-500" : "text-white";
        const unitClass = colorTheme === 'red' ? "text-sm text-red-900 font-bold ml-1" : "text-sm text-slate-500 font-bold ml-1";
        
        resPowerEl.innerHTML = `
            <div class="flex items-baseline">
                <span class="${valClass}">${this.formatNum(hp, 2)}</span>
                <span class="${unitClass}">HP</span>
            </div>
            <span class="text-slate-700 mx-3 italic opacity-50 text-2xl font-light">/</span>
            <div class="flex items-baseline">
                <span class="${valClass}">${this.formatNum(kw, 2)}</span>
                <span class="${unitClass}">kW</span>
            </div>
        `;
    },

    resetTool() {
        location.reload();
    },

    generateReport() {
        const btn = this.el['lang-btn'];
        btn.style.display = 'none';
        
        html2canvas(document.querySelector("#capture-area"), { 
            backgroundColor: "#020617", 
            scale: 2, 
            useCORS: true, 
            logging: false,
            windowWidth: 375,
            onclone: (clonedDoc) => {
                const grid = clonedDoc.getElementById('report-grid');
                if(grid) grid.style.backgroundColor = '#0f172a';
            }
        }).then(canvas => {
            const link = document.createElement('a'); 
            link.download = `Industrial_V3.0_${new Date().toISOString().slice(0,10)}.png`; 
            link.href = canvas.toDataURL("image/png"); 
            link.click();
            btn.style.display = 'block';
        }).catch(err => {
            console.error("Screenshot failed:", err);
            alert("截圖失敗，請檢查瀏覽器設定。");
            btn.style.display = 'block';
        });
    }
};

// Start the App
document.addEventListener('DOMContentLoaded', () => app.init());
</script>
</body>
</html>